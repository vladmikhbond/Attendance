@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
    var students = Model.Staff.GroupBy(s => s.GroupName);
}

<div class="text-center">

    <form asp-page="Index" method="post" enctype="multipart/form-data">
        <input asp-for="UploadedFile" />
        <input type="hidden" id="when" name="when" />
    </form>
    <p></p>
    <h3>@Model.When</h3>
    <h4>Presents (@Model.Staff.Count(x => x.IsPresent) из @Model.Staff.Count() )</h4>
    <table>
        @foreach (var group in students)
        {
            <tr>
                <td style="font-weight:800">@group.Key (@group.Count(x => x.IsPresent) из @group.Count() )</td>
            </tr>
            @foreach (var stud in group)
            {
                var color = stud.IsPresent ? "black" : "red";
                <tr>
                    <td style="text-align:left; color:@color">@stud.Surname @stud.Name</td>
                </tr>
            }
        }
    </table>

</div>
@section Scripts {
   <script>
       let uploadedFile = document.getElementById("UploadedFile");
       let when = document.getElementById("when");
       let form = document.querySelector("form");
       uploadedFile.addEventListener('change', function (e) {
           when.value = this.files[0].lastModifiedDate;
           form.submit();
       });

   </script>
}